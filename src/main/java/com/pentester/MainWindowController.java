package com.pentester;

import java.net.URL;
import java.util.*;
import javafx.fxml.FXML;
import javafx.fxml.Initializable;
import javafx.geometry.Insets;
import javafx.scene.control.*;
import javafx.scene.layout.VBox;

public class MainWindowController implements Initializable
{
	@FXML
	public Accordion toolbox;
	@FXML
	public TextArea descriptionBox;
	@FXML
	public ListView optionsListView;
	
	@Override
	public void initialize(URL arg0, ResourceBundle arg1) {
		populateList();
	}
	
	public void selectItem() 
	{
		System.out.println(true);
	}
	
	@SuppressWarnings("unchecked")
	private void populateList()
	{
		try
		{
			//test
			// Load all tools from the specified path
			ToolEngine te = new ToolEngine();
			te.loadTools("C:\\Users\\Hazem\\Documents\\Eclipse Projects\\PentestingGui\\src\\Tools");
			
			Map<Integer, String> map = te.getCategoryMap();
			ArrayList<Tool> tools = te.getAllTools();
			ArrayList<TitledPane> panes = new ArrayList<TitledPane>();
			
			// Add category panes to the accordion
			for(int i = 0; i < map.size(); i++)
			{
				VBox vbox = new VBox();
				vbox.setPadding(new Insets(1,1,1,1));
				
				TitledPane tp = new TitledPane(map.get(i - 1), vbox);
				
				toolbox.getPanes().add(tp);
				panes.add(tp);
			}
			
			// Fill up the pane with the matching tools
			for(int i = 0; i < tools.size(); i++)
			{
				String category = tools.get(i).getCategory();
				
				if(map.containsValue(category))
				{
					int key = 0;
					
					for(Map.Entry<Integer, String> entry : map.entrySet())
					{
						if(entry.getValue().equals(category))
							key = entry.getKey() + 1;
					}
					
					Button item = new Button(tools.get(i).getToolName());
					item.setUserData(tools.get(i));
					item.setMaxWidth(Double.MAX_VALUE);
					
					item.setOnMouseClicked(event -> {
						Tool selectedTool = (Tool) item.getUserData();
						descriptionBox.setText(selectedTool.getToolDescription());
						optionsListView.getItems().clear();
						optionsListView.getItems().addAll(selectedTool.getToolOptions());
					});
					
					VBox vbox = (VBox) panes.get(key).getContent();
					vbox.getChildren().add(item);
				}
			}
		} 
		catch (Exception e)
		{
			System.out.println(e.getStackTrace());
		}
	}
}
